class d{constructor(n,e){var t;this.form=n,this.data=e.data,this.intent=(t=e.data)==null?void 0:t.intent,this.parentWrapper=this.form.parents(".buymecoffee_form_preview_wrapper")}init(){var a,s,m;this.startPaymentProcessing();const n=this.generatePayButton();var e=Stripe((m=(s=(a=this.data)==null?void 0:a.order_items)==null?void 0:s.payment_args)==null?void 0:m.public_key);const t=e.elements({clientSecret:this.intent.client_secret}),r=t.create("payment",{}),y="#"+this.form.attr("id")+" .buymecoffee_payment_processor";r.mount(y);let _=this;r.on("ready",h=>{this.afterPaymentProcessorReady(n),this.form.find("#buymecoffee_pay_now").on("click",function(u){u.preventDefault(),jQuery(this).text("Processing..."),t.submit().then(p=>{e.confirmPayment({elements:t,confirmParams:{},redirect:"if_required"}).then(o=>{var c,f;jQuery(this).text("Redirecting..."),_.afterPaymentSuccess(),(c=o==null?void 0:o.paymentIntent)!=null&&c.id&&jQuery.post(window.buymecoffee_general.ajax_url,{action:"buymecoffee_payment_confirmation_stripe",intentId:(f=o==null?void 0:o.paymentIntent)==null?void 0:f.id})})}).catch(p=>{console.log(p,"kk"),jQuery(this).text(buttonText)})})})}generatePayButton(){return"<button id='buymecoffee_pay_now' style='margin-top: 20px;width: 100%;' type='submit'>"+("Pay "+this.form.find(".wpm_payment_total_amount_prefix").text()+parseInt(this.intent.amount)/100+" Now")+"</button>"}startPaymentProcessing(){this.form.find(".buymecoffee_payment_processor").parent().prepend("<p class='buymecoffee_loading_processor'>Payment processor loading...<p/>"),this.parentWrapper.find(".buymecoffee_input_content, .buymecoffee_pay_methods, .buymecoffee_payment_item",".wpm_submit_button").hide()}afterPaymentSuccess(){var e,t,r;const n="<a href='"+((r=(t=(e=this.data)==null?void 0:e.order_items)==null?void 0:t.payment_args)==null?void 0:r.success_url)+"'>View Receipt</a>";this.parentWrapper.append("<div class='buymecoffee_form_receipt'>Thanks for your contribution \u{1F5A4}<br/>"+n+"</div>"),this.parentWrapper.find(".buymecoffee_form").hide(),this.parentWrapper.find(".buymecoffee_form_to").hide()}afterPaymentProcessorReady(n){this.form.prepend("<p class='complete_payment_instruction'>Please complete your donation with Stripe \u{1F447}</p>"),this.form.find(".buymecoffee_payment_processor").append(n),this.form.find(".buymecoffee_loading_processor").remove()}}window.addEventListener("buymecoffee_payment_next_action_stripe",function(i){new d(i.detail.form,i.detail.response).init()});
