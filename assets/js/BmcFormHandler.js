class n{constructor(t,e){this.form=t,this.selector=".buymecoffee_form",this.customQuantity=!1,this.config=e,this.paymentMethod="",this.generalConfig=window.buymecoffee_general,this.$formNoticeWrapper=t.parent().find(".buymecoffee_form_notices")}$t(t){return this.generalConfig.i18n[t]?this.generalConfig.i18n[t]:""}initForm(){this.form.trigger("buymecoffee_single",[this,this.config]),this.calculatePayments(),this.form.find('.buymecoffee_payment, .bmc_coffee input[type="radio"]').on("change",t=>{this.calculatePayments()}),this.form.find('.bmc_coffee input[type="radio"]').on("change",t=>{this.toggleCustomQuantity(!1)}),this.form.find(".buymecoffee_custom_quantity").on("change",t=>{this.form.find('.bmc_coffee input[type="radio"]').prop("checked",!1),this.toggleCustomQuantity(!0)}),this.maybeSelectFirstPaymentMethod(),this.setSelectedMethod(),this.form.find(".buymecoffee_pay_method input").on("change",t=>{this.setSelectedMethod(),this.form.find(".buymecoffee_pay_methods label").removeClass("wpm_payment_active"),jQuery(t.target).parent().addClass("wpm_payment_active")}),this.form.on("submit",t=>{t.preventDefault(),this.handleFormSubmit(this.form)})}handleFormSubmit(t){t.find("button.wpm_submit_button").attr("disabled",!0),t.addClass("wpm_submitting_form"),t.parent().find(".wpm_form_notices").hide(),jQuery.post(window.buymecoffee_general.ajax_url,{action:"buymecoffee_submit",payment_total:t.data("wpm_payment_total"),coffee_count:t.data("coffee_count"),payment_method:t.data("wpm_selected_payment_method"),currency:t.data("wpm_currency"),form_data:jQuery(t).serializeArray()}).then(e=>{var a,i;if((a=e.data)!=null&&a.redirectTo&&(window.location.href=e.data.redirectTo),((i=e.data)==null?void 0:i.actionName)=="custom"){this.fireCustomEvent(e.data.nextAction,e);return}}).catch(e=>{var a,i;alert((i=(a=e==null?void 0:e.responseJSON)==null?void 0:a.data)==null?void 0:i.message)})}fireCustomEvent(t,e){var a;window.dispatchEvent(new CustomEvent("buymecoffee_payment_next_action_"+((a=e==null?void 0:e.data)==null?void 0:a.nextAction),{detail:{form:this.form,response:e}}))}maybeSelectFirstPaymentMethod(){var e;let t=this.form.find("input:radio[name='wpm_payment_method']");t.length===1&&((e=t.closest(".buymecoffee_pay_methods"))==null||e.hide()),t.first().length?t.first().attr("checked",!0):this.form.find("button.wpm_submit_button").css("cursor","not-allowed").attr("disabled",!0)}setSelectedMethod(){let t=this.form.find(".buymecoffee_pay_method input:checked");this.form.data("wpm_selected_payment_method",t.val()),t.parent().addClass("wpm_payment_active")}toggleCustomQuantity(t){var i;this.customQuantity=t;const e=this.form.find(".buymecoffee_custom_quantity");let a;this.customQuantity?(e.addClass("custom_quantity_active"),a=this.form.find(".buymecoffee_custom_quantity").val()):(a=(i=this.form.find('.bmc_coffee input[type="radio"]:checked'))==null?void 0:i.val(),e.removeClass("custom_quantity_active")),this.form.data("coffee_count",a||1),this.calculatePayments()}calculatePayments(){let t=this.form.find(".buymecoffee_payment").val(),e=this.form.data("coffee_count")?this.form.data("coffee_count"):1,a=parseInt(parseFloat(t)*100*e);this.form.data("wpm_payment_total",a),this.form.find(".wpm_submit_button .wpm_payment_total_amount").html(parseInt(t*e))}}export{n as B};
